# 起步

## git起步

安装git

git config --global uesr.name 用户名

git config --global user.email 邮箱地址

## 图形化git起步

安装vscode

安装git graph插件

安装git blame插件：状态栏显示光标所在行的编辑者、编辑时间。

## 项目起步

### （推荐）远程克隆

1. 在gitee新建纯空仓库，复制其https地址。
2. 在vscode新建窗口（Ctrl+Shift+N）选择克隆到某个文件夹里。
3. master有commit记录才能切换分支，第一件事就是写个readme将master发布（messge：初始化）。这样master也就成为了默认分支。如果在master前先同步其他分支会出现问题：默认分支是第一个上传的分支。master如果无法上传，多试几次，或者在远程新建对应分支（最好不要）。发布master之后切换分支开始工作。

其他方案：
本地

本地后远程

# 教程

## 仓库

仓库：

- 新建远程仓库，并复制https地址，使用vscode进行克隆。
- vscode克隆仓库：文件/新建窗口（Ctrl+Shift+N），选择从远程仓库克隆。选择的文件夹位置会在里面生成一个项目名的文件夹，文件夹里存放项目代码。
- 一个本地仓库可以绑定多个远程仓库。如果本地仓库只绑定一个远程仓库，该远程仓库一般不使用远程仓库名，而是origin。
- 本地主分支叫main，github主分支叫master。

## 提交

- 代码被修改，会产生“更改”文件。

- 对代码进行修改后，达到一个阶段性小功能，提交代码。
- 提交代码要养成提交暂存而不是提交所有文件（包括未追溯文件）的习惯、而且要先检查一下代码。
- 提交要写提交信息，如果没有，会弹出一个文件，在该文件内填写信息，关闭文件即可完成提交。如果没有填写，则取消本次提交。
- 忽略追溯：在仓库中新建`.gitignore`文件，可以忽略未追溯的文件。文件如果不被追溯仍放在仓库中，可能会丢失。如果文件已经提交过，状态是追溯的，不会对忽略生效。

修改已提交的内容:

- **amend：提交（修改），如果发现最近一次提交有错误，可以通过”提交（修改）“操作覆盖最近一次提交，该操作不要对已经同步到远程的提交操作！**
- 修改历史提交（同样不要对远程操作！）：在后面cherry-pick和rebase -i会讲。
- 撤销提交：为了修改历史提交放弃提交或者想放弃提交，使用reset。分支也会跟随到该提交。（不要对远程操作！）
- **撤销提交：新建节点，该节点内容为以前的内容，放弃了被撤销的提交中的内容。对远程安全，建议使用。**

位置：

- 在指令中说明想要操作的对象的位置进而可以操作对象。每个位置对应每个提交。
- head指向后是固定在指向的对象上的。提交是固定的，head指向提交，就一直是固定的。分支是移动的，head指向分支，分支又指向提交，head就指向提交，而head指向的提交随着分支的指向而改变。

- 绝对位置：commitID、分支、HEAD

- 相对位置：绝对位置+注记符

- 示例

``` git
HEAD：head所在位置
选择父节点
HEAD^：head的父节点
HEAD^2：head的第二个父节点
选择祖先节点
HEAD~：父节点
HEAD~~：+2节点
HEAD~2：+2节点
路径组合
HEAD~~^2~3：head的爷节点的第二个父节点的第三级祖先节点。
```

## 分支

（本地内容）

创建分支

- 从任一提交处都可以新建一个分支。

发布分支

- 创建新分支后可以发布到远程。

删除分支

- 可以直接删除其他分支。如果需要删除当前分支，要切换成其他分支才能将其删除。

切换分支

- head指向的分支就是当前分支。
- 切换分支就是改变head指向到其他分支。

（切换分支）存储：

- 代码没写完要切换到其他分支，可以将当前的代码暂存起来。
- 暂存后为提交的代码会存在存储里，当前代码会还原成最近一个提交的状态。

- 暂存属于本地。你的暂存在远程是看不到的。

- pop暂存=应用暂存+删除暂存。
- 可以在任意位置（分支、提交、head）读取暂存。

移动分支

- 将分支移动到其他地方的方法。
- 提交。分支默认跟随最新提交。
- 合并。如果分支有子孙分支，分支合并子孙分支即分支移动到子孙分支位置。
- 移动到指定位置。git branch -f 要移动的分支 移到的位置。
- 移动分支只能移动到祖先节点，因为对于这个分支来说，其子孙节点本来就是不存在的，所以严格来说移动到子孙节点并不是单纯的移动，而是创建了新节点然后移动。可以通过merge指定到某个子孙节点。

（移动分支、分支身份）标签：

- 对某次提交使用。因为分支是可以转移到其他地方的(git branch -f 要转移的分支 转移到的位置)，所以标签（固定）作为锚点可以标记这条分支的身份。

（远程内容）

同步分支：

- 同步分支=拉取分支+推送分支。
- 如果分支已拉取，同步就是推送。
- 同步只对当前分支生效。

拉取分支：

- 默认等于fetch（抓取）+merge（合并）
- 拉取（变基）等于fetch（抓取）+rebase（合并）
- 合并后，本地分支（当前分支）成为远程分支的子孙节点。

抓取分支：

- 抓取用于在本地仓库中更新远程仓库的信息（主要是下载更新远程分支的位置）

- 抓取远程仓库所有提交、分支、HEAD。
- 分支、HEAD会以前缀”远程仓库名/"表明该分支、HEAD是远程分支、远程HEAD。
- 本地分支用分支名表示，远程分支用远程仓库名/分支名表示，如果本地和远程达到同步，在本文中用分支名/远程仓库名表示。

合并分支：

- 合并分支的结果是当前的分支将成为被合并分支的子分支。对于merge，被合并分支是第二祖先分支，原来的分支是第一祖先分支。对于rebase，被合并分支是唯一的祖先分支。
- rebase更简洁，merge可以保留当前分支原来的记录。在本地合并应该使用merge，在远程为了简洁，一般使用rebase（git pull --rebase）。
- 要合并的两个分支如果存在祖先关系，祖先分支（当前分支）移动到子孙分支（被合并分支）处。merge和rebase效果相同。

嫁接：

- 变基
- cherry-pick
- rebase -i

## 指令

git commit --amend修改当前commit

### 新建

git commit创建提交

git branch branch-name创建新分支

git cherry-pick c1 c2从当前位置新建分支

git merge branch-name新建一个提交，接受branch-name分支的汇入与冲突解决。

git rebase branch-name将当前分支转到目标分支的前头。可能在目标分支上新建多个冲突解决提交。

git rebase -i 位置：在该位置新建分支，分支的提交来自原来的位置到该位置的所有提交。

git revert 位置：新建节点撤销该位置的内容。

git checkout -b branch-name新建并切换分支

### 移动head

git checkout 位置

git checkout -b branch-name新建并切换分支

git merge branch-name移动到前头

git rebase branch-name移动到前头

git branch -f 分支 位置：移动分支到某位置

git reset 位置，移动到此处且前头作废。

# 操作

## 源代码管理（Ctrl+Shift+G）

~~源代码管理储存库：冗余功能，建议隐藏。~~

源代码管理：

功能：**以树查看**（推荐）、~~提交（冗余）~~、刷新、~~graph（冗余）~~、更多

![image-20230111224906673](D:\tplmydata\tplmydoc\文档图片\image-20230111224906673.png)

面板功能：

如果有暂存则提交暂存，如果没有暂存就提交所有未暂存。推荐先暂存再提交的好习惯。

**部分暂存**：将unstaged部分add到staged里。推荐。

**全部暂存**：直接commit。

提交时没有填入信息，会弹出一个文件，在文件填入信息后关闭文件即可完成提交。如果直接关闭文件，则取消提交。

**右键未追溯文件可以将其添加到忽略中。**

**更多**：

![image-20230112095258225](D:\tplmydata\tplmydoc\文档图片\image-20230112095258225.png)

~~查看和排序（冗余）：以树查看~~

**拉取**：merge

~~**推送**：冗余，状态栏的**同步**可以使用~~

克隆：再开一个新的仓库

~~签出到：冗余，使用graph签出。~~

~~抓取：冗余，使用graph抓取。~~

~~显示Git输出：冗余，再输出，选择git即可。也很少查看git输出。~~

**提交**：

- ~~提交：就是常用的提交，提交已暂存文件与全部提交的智能集合，有快捷键，冗余~~
- ~~提交已暂存文件~~
- ~~全部提交~~
- 撤销上次提交：撤销某个commit，包括合并产生的commit。
- 中止变基：未知
- **提交已暂存文件（修改）**：amend，对最新commit进行修改。
- ~~全部提交（修改）：两个amend看情况使用。最好使用上一个。~~
- 提交已暂存文件（已署名）：未知
- ~~全部提交（已署名）~~

~~更改：~~

- ~~暂存所有更改，取消暂存所有更改，**放弃所有更改（谨慎！）**。对所有文件使用，容易出错，不建议使用！~~

**拉取**、推送：

- ~~同步：等于拉取（merge）+推送，冗余~~
- ~~拉取：等于fetch+merge~~
- **拉取（变基）**：将本地分支嫁接到下载到本地的远程分支上。
- 拉取自：带参的pull，git pull origin 远程source:本地分支。拉取某个远程commit到某个本地分支。不常用。
- ~~推送~~
- 推送到：带参的push，git push origin 本地source:远程分支，推送本地的某个提交到远程分支上。不常用。
- ~~抓取：冗余~~
- 获取（删除）：未知
- 从所有远程储存库中拉取：有多个远程储存库可以使用。不常用。

~~分支：~~

- ~~合并~~
- ~~变基~~
- ~~创建~~：菜单栏
- ~~从现有来源创建新的分支~~：菜单栏
- ~~重命名~~
- ~~删除~~
- ~~发布~~：面板有。

远程：用于管理多个远程库。不常用。

~~**存储**~~：

- ~~储存：将未提交的代码临时保存到本地~~
- ~~**储存（包含未追踪)**：这个更常用。~~
- ~~应用：应用以后储存仍存在。~~
- ~~弹出：弹出=应用+删除。~~
- ~~删除~~

~~标记：创建标记、删除标签。冗余。~~

## 状态栏

![image-20230112095514158](D:\tplmydata\tplmydoc\文档图片\image-20230112095514158.png)

切换分支：

- **创建分支**：从某个分支创建分支。
- 签出分离：冗余，用graph
- **切换分支**

**同步**：也可以使用面板的。

**Git Graph**：打开graph。

## 解决冲突

解决冲突（从简单到复杂）

![image-20230110182149539](D:\tplmydata\tplmydoc\文档图片\image-20230110182149539.png)

0. 简单的解决看这三个选项就可以了。也可以直接上手修改。（未）

1. 这个界面可以直接看到区别，也可以使用**比较变更**，更加明显。（未）

2. 合并编辑器：使用功能或者直接上手修改。

   1. 一般先使用功能，必要再配上手动修改。
      1. 接受的组合，一般也用不到吧感觉。冲突一般是不共存的。
         1. 接受当前+接受传入
         2. 接受传入+接受当前（符合逻辑）
         3. 接受当前
         4. 接受传入
         5. 删除当前
         6. 删除传入
      2. 接受组合，两边接受组合的结果不一样，当前的接受组合的结果不可理解。这里删除相当于接受另一方了。

   2. 手动修改后可以重置。

![image-20230110182921619](D:\tplmydata\tplmydoc\文档图片\image-20230110182921619.png)

合并分支会产生一个新的commit。这个commit不属于任何一个分支，而是继承自两个分支，并立于传入分支上（也就是最后一个合并的分支）。

解决冲突后，分支发现与落后于分支但不冲突，合并分支后再继续写代码。

![image-20230110184240840](D:\tplmydata\tplmydoc\文档图片\image-20230110184240840.png)



## Git Graph插件

### 读图（待编辑）



### 操作

打开方式：状态栏、打开的编辑器（Ctrl+Tab）。

| 操作（列表上方的ui）                         |
| -------------------------------------------- |
| branches：显示的分支。不常用其实。搜索：未知 |
| ~~输出：冗余~~                               |
| 设置                                         |
| **抓取**                                     |
| 刷新graph                                    |

graph列表内容：项（提交）、Uncommited Changes、分支、HEAD

**双击分支：快速切换分支**

左键操作：查看项

右键操作：

| 当前提交、其他提交                                           | Uncommited Changes                                           | 当前分支                                                     | 其他分支                                                     | HEAD                                                         | 标签                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20230112101512923](D:\tplmydata\tplmydoc\文档图片\image-20230112101512923.png) | ![image-20230112101808381](D:\tplmydata\tplmydoc\文档图片\image-20230112101808381.png) | ![image-20230112102131406](D:\tplmydata\tplmydoc\文档图片\image-20230112102131406.png) | <img src="D:\tplmydata\tplmydoc\文档图片\image-20230112101737163.png" alt="image-20230112101737163"  /> | ![image-20230112102214573](D:\tplmydata\tplmydoc\文档图片\image-20230112102214573.png) | ![image-20230112113110358](D:\tplmydata\tplmydoc\文档图片\image-20230112113110358.png) |
| - 添加标签<br />- 新建分支<br />- 签出<br />- cherry-pick<br />- 撤销<br />- 合并<br />- 变基<br />- 回滚 | - 暂存<br />- 回滚：未知<br />- 清除<br />- 打开源代码管理   | - 重命名<br />- 推送<br />- 锚点：未知<br />- 不显示：无用   | - 切换到该分支<br />- 重命名<br />- 删除<br />- 合并<br />- 变基<br />- 推送 | - 切换到分支<br />- 删除远程分支<br />- 合并<br />- 推送     | - 查看<br />- 删除<br />- 推送<br />                         |
|                                                              |                                                              |                                                              |                                                              |                                                              |                                                              |


# 实践

## 操作

#### 开始工作

克隆仓库后应该fetch查看master仓库是否存在远程关联，如果没有，要上传master。然后开始工作前，要切换到工作分支。

#### 工作时：修改记录

提交、**修改（推荐revert）**、暂存、合并、变基、cherry-pick、rebase -i、标签、签出、reset**（使用时要注意，推荐revert**）、revert（推荐）

#### 工作完毕：合并分支

切换到dev分支，同步远程。然后将工作分支合并merge过来，然后上传远程时使用pull --rebase，解决冲突后push。如果需要在工作分支继续工作，则切换回工作分支并合并dev。如果不需要，则在dev上新建一个分支开始新的功能（不建议，会导致产生很多分支）。

切换到master，同步远程，然后**cherry-pick在dev上需要的功能**。可以在要给master分支的dev提交节点上加标签或者有象征意义的commit message。

直接同步也可以：切换分支，同步，合并其他分支，同步。

### 合并分支

fetch，merge dev远程分支解决冲突（有commit），切到本地dev合到刚才合并的新的分支点（无commit），push。

## 问题

### 远程删除仓库后重新添加仓库

发布master可同步master。其他分支可发布就发布，不可发布，则pull --rebase后发布。

### 提交时未备注message

提交时没有填入信息，会弹出一个文件，在文件填入信息后关闭文件即可完成提交。如果直接关闭文件，则取消提交。

### concluded

![image-20230112093939712](D:\tplmydata\tplmydoc\文档图片\image-20230112093939712.png)

原因：远程分支已有的commit，你在本地进行了reset，导致两个冲突了。

解决方法：

1. 如果没有修改，merge到远程分支即可。如果做了修改，reset（wild）到分叉处，暂存修改，merge（无commit）到远程分支，然后revert到分叉处，读取暂存。

![image-20230112115141607](D:\tplmydata\tplmydoc\文档图片\image-20230112115141607.png)

原因：远程没有与当前分支同名的分支。

解决方法：在远程新建一个分支，或者将该分支与其他远程分支进行绑定（git push 分支:远程分支）

## 建议

养成先暂存再提交的好习惯。

rebase更简洁，merge可以保留当前分支原来的记录。在本地合并应该使用merge，在远程为了简洁，一般使用rebase（git pull --rebase）。

少用reset，要注意不要reset到origin的祖先节点。

