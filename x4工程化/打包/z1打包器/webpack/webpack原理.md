
## æ¨¡å—åŒ–
webpack æ”¯æŒ commonjs å’Œ esmodule
å®ƒçš„åŸç†ï¼š

CommonJS æ¨¡å—åŒ–å®ç°åŸç†
ES Module å®ç°åŸç†
CommonJS åŠ è½½ ES Module çš„åŸç†ï¼ˆesm å¯¼å‡ºï¼Œcjs å¯¼å…¥ï¼‰
ES Module åŠ è½½ CommonJS çš„åŸç†ï¼ˆcjs å¯¼å‡ºï¼Œesm å¯¼å…¥ï¼‰

commonjs è¿è¡Œè¿‡ç¨‹
1. modules å¯¹è±¡å­˜å‚¨æ‰€æœ‰æ¨¡å—
2. æ¨¡å—çš„è·¯å¾„ä½œä¸º modules çš„é”®ï¼Œå€¼ä¸ºå‡½æ•°è¿”å› module. exports å¯¹è±¡ã€‚
3. require å‡½æ•°è¯»å– modules çš„å€¼æ‰§è¡Œè¿”å› module. exports å¯¹è±¡
```
var modules = {
  "./name.js": () => {
    var module = {};
    module.exports = "ä¸è¦ç§ƒå¤´å•Š";
    return module.exports;
  },
};
const require = (modulePath) => {
  return modules[modulePath]();
};

let author = require("./name.js");
console.log(author, "author");
```
commonjs åŸç†
1. modules å¯¹è±¡ä»¥è·¯å¾„ä¸ºé”®å­˜å‚¨å‡½æ•°ï¼Œå‡½æ•°ä¼šç»™ä¼ æ¥çš„å‚æ•°æŒ‚è½½ exports å±æ€§
2. require æ—¶ï¼ŒæŸ¥çœ‹ cacheã€‚
3. cache ä¸ºç©ºï¼Œåˆ›å»º module å¹¶ä½œä¸ºå‚æ•°ä¼ ç»™ modules\[path\]æŒ‚è½½ exports å±æ€§ã€‚
4. æœ€å require è¿”å›è¿™ module. exports å¯¹è±¡
```
//æ¨¡å—å®šä¹‰
var modules = {
  "./src/name.js": (module) => {
    module.exports = "ä¸è¦ç§ƒå¤´å•Š";
  },
};
var cache = {};

//æ¥å—æ¨¡å—çš„è·¯å¾„ä¸ºå‚æ•°ï¼Œè¿”å›å…·ä½“çš„æ¨¡å—çš„å†…å®¹
function require(modulePath) {
  var cachedModule = cache[modulePath]; //è·å–æ¨¡å—ç¼“å­˜
  if (cachedModule !== undefined) {
    //å¦‚æœæœ‰ç¼“å­˜åˆ™ä¸å…è®¸æ¨¡å—å†…å®¹ï¼Œç›´æ¥retuenå¯¼å‡ºçš„å€¼
    return cachedModule.exports;
  }
  //å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œåˆ™å®šä¹‰moduleå¯¹è±¡ï¼Œå®šä¹‰exportså±æ€§
  //è¿™é‡Œæ³¨æ„ï¼ï¼ï¼module = cache[modulePath] ä»£è¡¨å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€
  var module = (cache[modulePath] = {
    exports: {},
  });
  //è¿è¡Œæ¨¡å—å†…çš„ä»£ç ï¼Œåœ¨æ¨¡å—ä»£ç ä¸­ä¼šç»™module.exportså¯¹è±¡èµ‹å€¼
  modules[modulePath](module, module.exports, require);

  //å¯¼å…¥module.exportså¯¹è±¡
  return module.exports;
}

(() => {
  let author = require("./src/name.js");
  console.log(author, "author");
})();

```

esmodule ç±»ä¼¼
1. å®šä¹‰ modules å¯¹è±¡ï¼Œå±æ€§å€¼ä¸ºç»‘å®šå‡½æ•°
2. require è°ƒç”¨å¹¶è·å¾—å…¶ module. exports å¯¹è±¡

## æ‡’åŠ è½½
åœ¨ Webpack ä¸­å¸¸ç”¨çš„ä»£ç åˆ†ç¦»æ–¹æ³•æœ‰ä¸‰ç§ï¼š

å…¥å£èµ·ç‚¹ï¼šä½¿ç”¨Â entryÂ é…ç½®æ‰‹åŠ¨åœ°åˆ†ç¦»ä»£ç ã€‚
é˜²æ­¢é‡å¤ï¼šä½¿ç”¨Â Entry dependenciesÂ æˆ–è€…Â SplitChunksPluginÂ å»é‡å’Œåˆ†ç¦» chunkã€‚
åŠ¨æ€å¯¼å…¥ï¼šé€šè¿‡æ¨¡å—çš„å†…è”å‡½æ•°è°ƒç”¨æ¥åˆ†ç¦»ä»£ç ã€‚

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼š https://juejin.cn/post/7152516872330543141/

æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

åŸç†ï¼š
1. jsonp è¯·æ±‚æ–‡ä»¶
2. åˆå¹¶ modules
3. requireåŠ è½½æ¨¡å—
![[Pasted image 20230815233313.png]]

å…·ä½“å®ç°ï¼š
1. require. e è°ƒç”¨ require. jï¼Œj é€šè¿‡ jsonp æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚
2. ç›®æ ‡æ–‡ä»¶æ˜¯è°ƒç”¨æˆ‘ä»¬æä¾›çš„å‡½æ•°è¿›è¡Œå®‰è£…ã€‚
3. e å then çš„æ˜¯ requireï¼Œè¿”å› module. exports å¯¹è±¡ã€‚


## AST
EStree è§„èŒƒã€‚

ä¸€ä¸ªå®Œæ•´çš„ç¼–è¯‘å™¨æ•´ä½“æ‰§è¡Œè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š

Parsing (è§£æè¿‡ç¨‹)ï¼šè¿™ä¸ªè¿‡ç¨‹è¦ç»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€æ„å»º ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ä¸€ç³»åˆ—æ“ä½œï¼›
Transformationï¼ˆè½¬åŒ–è¿‡ç¨‹ï¼‰ï¼šè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å°†ä¸Šä¸€æ­¥è§£æåçš„å†…å®¹ï¼ŒæŒ‰ç…§ç¼–è¯‘å™¨æŒ‡å®šçš„è§„åˆ™è¿›è¡Œå¤„ç†ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„è¡¨ç°å½¢å¼ï¼›Traversal(éå†ï¼Œæ·±åº¦ä¼˜å…ˆ) å’Œ Visitors (è®¿é—®å™¨)
Code Generationï¼ˆä»£ç ç”Ÿæˆï¼‰ï¼šå°†ä¸Šä¸€æ­¥å¤„ç†å¥½çš„å†…å®¹è½¬åŒ–ä¸ºæ–°çš„ä»£ç ï¼›

è¯æ³•åˆ†ææ˜¯ä½¿ç”¨ tokenizer(åˆ†è¯å™¨)æˆ–è€… lexer(è¯æ³•åˆ†æå™¨)ï¼Œå°†æºç æ‹†åˆ†æˆ tokensï¼Œtokens æ˜¯ä¸€ä¸ªæ”¾ç½®å¯¹è±¡çš„æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå•å…ƒï¼ˆæ•°å­—ï¼Œæ ‡ç­¾ï¼Œæ ‡ç‚¹ï¼Œæ“ä½œç¬¦...ï¼‰çš„æè¿°ä¿¡æ¯ã€‚
```
tokensæ•°ç»„ï¼ˆè¯æ³•åˆ†æï¼‰
[
  { type: "paren", value: "(" },
  { type: "name", value: "add" },
  { type: "number", value: "2" },
  { type: "paren", value: "(" },
  { type: "name", value: "subtract" },
  { type: "number", value: "4" },
  { type: "number", value: "2" },
  { type: "paren", value: ")" },
  { type: "paren", value: ")" },
];

è®¿é—®å™¨
const visitor = {
	NumberLiteral(node,parent){}, // å¤„ç†æ•°å­—ç±»å‹èŠ‚ç‚¹
	CallExpression(node,parent){} // å¤„ç†è°ƒç”¨è¯­å¥ç±»å‹èŠ‚ç‚¹
}
```

## babel
[å‰ç«¯å·¥ç¨‹åŒ–åŸºçŸ³ -- ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ä»¥åŠASTçš„å¹¿æ³›åº”ç”¨ğŸ”¥ - æ˜é‡‘](https://juejin.cn/post/7155151377013047304/#heading-14)

Babel å…¶å®å°±æ˜¯ä¸€ä¸ªæœ€å¸¸ç”¨çš„ Javascript ç¼–è¯‘å™¨ï¼Œå®ƒèƒ½å¤Ÿè½¬è¯‘Â ECMAScript 2015+Â çš„ä»£ç ï¼Œä½¿å®ƒåœ¨æ—§çš„æµè§ˆå™¨æˆ–è€…ç¯å¢ƒä¸­ä¹Ÿèƒ½å¤Ÿè¿è¡Œï¼Œå·¥ä½œè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼ˆå…¶å®å°±è·Ÿæˆ‘ä»¬ä¸Šé¢æ‰‹å†™çš„ä¸€æ ·ï¼Œç›¸ä¿¡å¤§å®¶ç°åœ¨è‚¯å®šå€æ„Ÿäº²åˆ‡ï¼‰ï¼š

Parse (è§£æ) å°†æºä»£ç è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œæ ‘ä¸Šæœ‰å¾ˆå¤šçš„ estree èŠ‚ç‚¹
Transform (è½¬æ¢) å¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œè½¬æ¢
Generate (ä»£ç ç”Ÿæˆ) å°†ä¸Šä¸€æ­¥ç»è¿‡è½¬æ¢è¿‡çš„æŠ½è±¡è¯­æ³•æ ‘ç”Ÿæˆæ–°çš„ä»£ç 

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼š https://juejin.cn/post/7155151377013047304/

å½“ç„¶æˆ‘ä»¬ç°åœ¨ä¸ç”¨ä»é›¶å¼€å§‹æ‰‹å†™äº†ï¼Œå¯ä»¥å€ŸåŠ©äº babel æ’ä»¶ï¼š

@babel/parserÂ å¯ä»¥æŠŠæºç è½¬æ¢æˆ AST
@babel/traverse ç”¨äºå¯¹ AST çš„éå†ï¼Œç»´æŠ¤äº†æ•´æ£µæ ‘çš„çŠ¶æ€ï¼Œå¹¶ä¸”è´Ÿè´£æ›¿æ¢ã€ç§»é™¤å’Œæ·»åŠ èŠ‚ç‚¹
@babel/generateÂ å¯ä»¥æŠŠ AST ç”Ÿæˆæºç ï¼ŒåŒæ—¶ç”Ÿæˆ sourcemap
@babel/typesÂ ç”¨äº AST èŠ‚ç‚¹çš„ Lodash å¼å·¥å…·åº“, å®ƒåŒ…å«äº†æ„é€ ã€éªŒè¯ä»¥åŠå˜æ¢ AST èŠ‚ç‚¹çš„æ–¹æ³•ï¼Œå¯¹ç¼–å†™å¤„ç† AST é€»è¾‘éå¸¸æœ‰ç”¨
@babel/coreÂ Babel çš„ç¼–è¯‘å™¨ï¼Œæ ¸å¿ƒ API éƒ½åœ¨è¿™é‡Œé¢ï¼Œæ¯”å¦‚å¸¸è§çš„ transformã€parseï¼Œå¹¶å®ç°äº†æ’ä»¶åŠŸèƒ½
```
yarn add @babel/core -D //é‡Œé¢å°±åŒ…å«äº†@babel/parserã€@babel/traverseã€@babel/generateã€@babel/typesç­‰

```

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼š https://juejin.cn/post/7155151377013047304/
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚


babel å·¥å…·å‡½æ•°
1. ç”Ÿæˆ astï¼ˆ@babel/parserï¼‰
2. ç”¨ visitor è½¬æ¢ astï¼Œï¼ˆ@babel/traverseï¼‰
3. ast ç”Ÿæˆä»£ç ï¼ˆ@babel/generatorï¼‰
4. ä½¿ç”¨æ’ä»¶ï¼š@babel/core çš„ transfom å‡½æ•°ã€‚æ¥æ”¶ codeï¼Œè‡ªåŠ¨è§£æï¼Œç„¶åä½¿ç”¨ plugins å¯¹è±¡æ•°ç»„çš„ vistor å±æ€§ä¿®æ”¹ astï¼Œæœ€åè¿”å›ç»“æœã€‚

babel æ’ä»¶
1. æ‹¥æœ‰ vistor å¯¹è±¡ä½œä¸ºå±æ€§çš„å¯¹è±¡ã€‚
2. apiï¼šapiï¼šblockStatement ã€returnStatementï¼Œå¯ä»¥ç”¨å®ƒä»¬æ¥ç”ŸæˆèŠ‚ç‚¹æˆ–åˆ¤æ–­èŠ‚ç‚¹ã€‚
```
let types = require("@babel/types"); //ç”¨æ¥ç”Ÿæˆæˆ–è€…åˆ¤æ–­èŠ‚ç‚¹çš„ASTè¯­æ³•æ ‘çš„èŠ‚ç‚¹

const arrowFunctionPlugin = {
  visitor: {
    //å¦‚æœæ˜¯ç®­å¤´å‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¼šè¿›æ¥æ­¤å‡½æ•°ï¼Œå‚æ•°æ˜¯ç®­å¤´å‡½æ•°çš„èŠ‚ç‚¹è·¯å¾„å¯¹è±¡
    ArrowFunctionExpression(path) {
      let { node } = path;
      node.type = "FunctionExpression";

      //å¦‚æœå‡½æ•°ä½“ä¸æ˜¯å—è¯­å¥
      if (!types.isBlockStatement(node.body)) {
        node.body = types.blockStatement([types.returnStatement(node.body)]); //ç”Ÿæˆä¸€ä¸ªå—è¯­å¥ï¼Œå¹¶å°†å†…å®¹return
      }
    },
  },
};
```

## loader
 Webpack æœ¬èº«åªèƒ½å¤„ç† js  å’Œ JSON æ–‡ä»¶ï¼Œå…¶ä»–ç±»å‹æ–‡ä»¶å®ƒæ˜¯ä¸èƒ½å¤Ÿå¤„ç†çš„ã€‚éœ€è¦å€ŸåŠ© Loader æ¥å¤„ç†è¿™äº›ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ‰æ•ˆçš„æ¨¡å—ã€‚Loader æœ¬è´¨ä¸Šæ˜¯å¯¼å‡ºå‡½æ•°çš„ JavaScript æ¨¡å—ï¼Œè€Œè¯¥æ¨¡å—å¯¼å‡ºçš„å‡½æ•°ï¼ˆè‹¥æ˜¯ ES6 æ¨¡å—ï¼Œåˆ™æ˜¯é»˜è®¤å¯¼å‡ºçš„å‡½æ•°ï¼‰
 
```
/**
 *
 * @param {string|Buffer} content æºæ–‡ä»¶çš„å†…å®¹
 * @param {object} [map] å¯ä»¥è¢« https://github.com/mozilla/source-map ä½¿ç”¨çš„ SourceMap æ•°æ®
 * @param {any} [meta] meta æ•°æ®ï¼Œå¯ä»¥æ˜¯ä»»ä½•å†…å®¹
 */
function webpackLoader(content, map, meta) {
  // ä½ çš„ webpack loader ä»£ç 
}

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼šhttps://juejin.cn/post/7157739406835580965
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
```
å¼•å…¥ loader
```
  module: {
    rules: [
      {
        test: /\.less$/,
        use: [
          "style-loader", //å°†csså†…å®¹å˜æˆstyleæ ‡ç­¾æ’å…¥åˆ°htmlä¸­å»
          "css-loader", //è§£æcssæ–‡ä»¶çš„è·¯å¾„ç­‰
          "less-loader", //å°†less=>css
        ],
      },
    ],
  },
æ‰§è¡Œé¡ºåºæ˜¯ä»å³å‘å·¦
```
use
1. å­—ç¬¦ä¸²
2. å¯¹è±¡ï¼Œå« loader è·¯å¾„ã€options é…ç½®ã€‚./loaders/simpleLoader.js
å¼€å‘è¾…åŠ©
```
resolveLoader: {
æ–¹æ³•ä¸€
 alias: {
   "simpleLoader": path.resolve(__dirname, "./loaders/simpleLoader.js"),
 },
 æ–¹æ³•äºŒï¼Œæ¨è
     //æ‰¾loaderçš„æ—¶å€™ï¼Œå…ˆå»loadersç›®å½•ä¸‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å†å»node_modulesä¸‹é¢æ‰¾
    modules: ["loaders", "node_modules"],
},
module: {
rules: [
  {
	test: /\.js$/,
	use: [
	  {
		loader: "simpleLoader",
		options: {
		  /* ... */
		},
	  },
	],
  },
],
},
```
loader ç±»å‹ï¼šå‰ç½® preã€æ™®é€š normalã€è¡Œå†… inlineã€åç½® postã€‚ç¼ºçœ normalï¼Œç”± use çš„åŒçº§ enforce çš„å€¼é…ç½®ã€‚

loader é¡ºåº
1. PitchingÂ é˜¶æ®µ: Loader ä¸Šçš„ pitch æ–¹æ³•ï¼ŒæŒ‰ç…§åç½® (post)ã€è¡Œå†… (inline)ã€æ™®é€š (normal)ã€å‰ç½® (pre)Â çš„é¡ºåºè°ƒç”¨ã€‚
2. NormalÂ é˜¶æ®µ: Loader ä¸Šçš„å¸¸è§„æ–¹æ³•ï¼ŒæŒ‰ç…§å‰ç½® (pre)ã€æ™®é€š (normal)ã€è¡Œå†… (inline)ã€åç½® (post)Â çš„é¡ºåºè°ƒç”¨ã€‚æ¨¡å—æºç çš„è½¬æ¢ï¼Œå‘ç”Ÿåœ¨è¿™ä¸ªé˜¶æ®µã€‚
3. åŒç­‰ç±»å‹ä¸‹çš„ Loader æ‰§è¡Œé¡ºåºæ‰æ˜¯ç”±å³å‘å·¦ï¼Œæˆ–è€…ç”±ä¸‹åˆ°ä¸Šæ‰§è¡Œã€‚

loader æ–‡ä»¶å¯¼å‡ºçš„å‡½æ•°å°±æ˜¯ normal loaderï¼Œå‡½æ•°çš„ pitch å±æ€§çš„å‡½æ•°å°±æ˜¯ pitching loaderã€‚å½“ä¸€ä¸ª Loader çš„ pitch é˜¶æ®µæœ‰è¿”å›å€¼æ—¶ï¼Œå°†è·³è¿‡åç»­ Loader çš„ pitch é˜¶æ®µï¼Œç›´æ¥è¿›è¡Œåˆ°è¯¥ Loader çš„ normal é˜¶æ®µã€‚
å›¾ç¤ºå‡è®¾æˆ‘ä»¬é…ç½® normal\[a, b, c\]ã€‚
pitchï¼špostã€inlineã€normalã€pre
normalï¼špreã€normalã€inlineã€post
![[Pasted image 20230819225636.png]]
![[Pasted image 20230819225642.png]]
```
Loader. pitch = function (remainingRequest, previousRequest, data) {
  console.log (remainingRequest, previousRequest, data)
};
```

è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•° dataï¼Œå¯ä»¥ç”¨äºæ•°æ®ä¼ é€’ã€‚å³åœ¨Â pitchÂ å‡½æ•°ä¸­å¾€Â dataÂ å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œä¹‹ååœ¨Â normalÂ å‡½æ•°ä¸­é€šè¿‡Â this. dataÂ çš„æ–¹å¼è¯»å–å·²æ·»åŠ çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ³¨å…¥ä¸Šä¸‹æ–‡ã€‚

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼š https://juejin.cn/post/7157739406835580965
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚


![[Pasted image 20230819224352.png]]
### å†…è” loader
æŒ‡å®šå¼•å…¥æ¨¡å—ä½¿ç”¨æŸä¸ªå…·ä½“ loader
```
// src/index.js
import test from "c-loader!./test.js"; //ä½¿ç”¨å†…è” Loader

const a = 1;
```

## plugin
tapable æ˜¯ä¸€ä¸ªç±»ä¼¼äº Node.js ä¸­çš„ EventEmitter çš„åº“ï¼Œä½†å®ƒæ›´ä¸“æ³¨äºè‡ªå®šä¹‰äº‹ä»¶çš„è§¦å‘å’Œå¤„ç†ã€‚é€šè¿‡ tapable æˆ‘ä»¬å¯ä»¥æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶æœºå»è§¦å‘æ‰§è¡Œã€‚ç±»æ¯”åˆ° Vue å’Œ React æ¡†æ¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°

tapable é‡‡ç”¨çš„æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œé€šè¿‡ tap å‡½æ•°æ³¨å†Œç›‘å¬å‡½æ•°ï¼Œç„¶åé€šè¿‡ call å‡½æ•°æŒ‰é¡ºåºæ‰§è¡Œä¹‹å‰æ³¨å†Œçš„å‡½æ•°ã€‚

è¿™é‡Œè¯¦ç»†è¯´ä¸€ä¸‹è¿™å‡ ä¸ªç±»å‹çš„æ¦‚å¿µï¼š

Basicï¼ˆåŸºæœ¬çš„ï¼‰ï¼šæ‰§è¡Œæ¯ä¸€ä¸ªäº‹ä»¶å‡½æ•°ï¼Œä¸å…³å¿ƒå‡½æ•°çš„è¿”å›å€¼
Waterfallï¼ˆç€‘å¸ƒå¼çš„ï¼‰ï¼šå¦‚æœå‰ä¸€ä¸ªäº‹ä»¶å‡½æ•°çš„ç»“æœÂ result !== undefinedï¼Œåˆ™ result ä¼šä½œä¸ºåä¸€ä¸ªäº‹ä»¶å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œç»“æœä¼šæˆä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼‰
Bailï¼ˆä¿é™©çš„ï¼‰ï¼šæ‰§è¡Œæ¯ä¸€ä¸ªäº‹ä»¶å‡½æ•°ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»“æœÂ result !== undefinedÂ åˆ™è¿”å›ï¼Œä¸å†ç»§ç»­æ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯åªè¦å…¶ä¸­ä¸€ä¸ªæœ‰è¿”å›äº†ï¼Œåé¢çš„å°±ä¸æ‰§è¡Œäº†ï¼‰
Loopï¼ˆå¾ªç¯çš„ï¼‰ï¼šä¸åœçš„å¾ªç¯æ‰§è¡Œäº‹ä»¶å‡½æ•°ï¼Œç›´åˆ°æ‰€æœ‰å‡½æ•°ç»“æœÂ result === undefined

loader çš„ pitch é˜¶æ®µ å°±æ˜¯ bail çš„ã€‚

### compiler
compiler å¯¹è±¡ä»£è¡¨äº†å®Œæ•´çš„ webpack ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªå¯¹è±¡åœ¨å¯åŠ¨ Webpack æ—¶è¢«ä¸€æ¬¡æ€§å»ºç«‹ï¼Œå¹¶é…ç½®å¥½æ‰€æœ‰å¯æ“ä½œçš„è®¾ç½®ï¼ŒåŒ…æ‹¬ optionsï¼Œloader å’Œ pluginã€‚å½“åœ¨ Webpack ç¯å¢ƒä¸­åº”ç”¨ä¸€ä¸ªæ’ä»¶æ—¶ï¼Œæ’ä»¶å°†æ”¶åˆ°æ­¤ compiler å¯¹è±¡çš„å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¿é—® Webpack çš„ä¸»ç¯å¢ƒã€‚

compilation å¯¹è±¡ä»£è¡¨äº†ä¸€æ¬¡èµ„æºç‰ˆæœ¬æ„å»ºã€‚å½“è¿è¡Œ Webpack å¼€å‘ç¯å¢ƒä¸­é—´ä»¶ï¼ˆ webpack-dev-serverï¼‰æ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ compilationï¼Œä»è€Œç”Ÿæˆä¸€ç»„æ–°çš„ç¼–è¯‘èµ„æºã€‚ä¸€ä¸ª compilation å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ã€‚compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šå…³é”®æ—¶æœºçš„å›è°ƒï¼Œä»¥ä¾›æ’ä»¶åšè‡ªå®šä¹‰å¤„ç†æ—¶é€‰æ‹©ä½¿ç”¨ã€‚

æŠŠ compiler æ¯”å–»æˆ React ç»„ä»¶ï¼Œåœ¨ React ç»„ä»¶ä¸­æœ‰ä¸€ç³»åˆ—çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆcomponentDidMount ()ã€render ()ã€componentDidUpdate ()ç­‰ç­‰ï¼‰ï¼Œè¿™äº›é’©å­å‡½æ•°éƒ½å¯ä»¥åœ¨ç»„ä»¶ä¸­è¢«å®šä¹‰ã€‚
æŠŠ compilation æ¯”å–»æˆ componentDidUpdate ()ï¼ŒcomponentDidUpdate ()åªæ˜¯ç»„ä»¶ä¸­çš„æŸä¸€ä¸ªé’©å­ï¼Œå®ƒä¸“é—¨è´Ÿè´£é‡å¤æ¸²æŸ“çš„å·¥ä½œï¼ˆcompilation åªæ˜¯ compiler ä¸­æŸä¸€é˜¶æ®µçš„ hook ,ä¸»è¦è´Ÿè´£å¯¹æ¨¡å—èµ„æºçš„å¤„ç†ï¼Œåªä¸è¿‡å®ƒçš„å·¥ä½œæ›´åŠ ç»†åŒ–ï¼Œåœ¨å®ƒå†…éƒ¨è¿˜æœ‰ä¸€äº›å­ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰ã€‚

Webpack Plugin æ˜¯ä¸€ä¸ªå« apply æ–¹æ³•çš„å¯¹è±¡ã€‚å½“ Webpack å†…éƒ¨è¿›è¡Œæ’ä»¶æŒ‚è½½æ—¶ä¼šæ‰§è¡Œ apply å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ apply æ–¹æ³•ä¸­è®¢é˜…å„ç§ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå½“åˆ°è¾¾å¯¹åº”çš„æ—¶é—´ç‚¹æ—¶å°±ä¼šæ‰§è¡Œã€‚

```
const chalk = require("chalk");//ç»™æ—¥å¿—åŠ é¢œè‰²æ’ä»¶
const execSync = require("child_process").execSync;

const error = chalk.bold.red; //çº¢è‰²æ—¥å¿—
const warning = chalk.keyword("orange"); //æ©˜è‰²æ—¥å¿—

class DonePlugin {
  apply(compiler) {
    compiler.hooks.done.tap("DonePlugin", () => {
      //è·å–gitè´¦å·ä¿¡æ¯çš„username
      let name = execSync("git config user.name").toString().trim();

      console.log(
        error(`${name},`),
        warning(
          "æˆ‘çŸ¥é“æ­¤åˆ»ä½ å¾ˆæ„å¤–ã€‚ä½†ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œæˆ‘çœ‹è§ä½ çš„ç¬¬ä¸€çœ¼å°±æ²¦é™·äº†...å¯ä»¥ç»™æˆ‘ä¸€ä¸ªå¤šäº†è§£äº†è§£ä½ çš„æœºä¼šå—ï¼Ÿ  â€”â€”â€”â€”æ¥è‡ªä¸€ä¸ªçƒ­å¿ƒå¸®ä½ è§£å†³é—®é¢˜çš„äºº"
        )
      );
    });
  }
}

module.exports = DonePlugin;

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼šhttps://juejin.cn/post/7160467329334607908
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
```

## tepable
Tapable çš„å†…éƒ¨ä»¥ç‰¹åˆ«å·§å¦™çš„æ–¹å¼å®ç°äº†å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè¿™ä¹‹ä¸­ä¼šæœ‰éå¸¸å¤šçš„çŸ¥è¯†ç‚¹ï¼šæ¯”å¦‚æ‡’ç¼–è¯‘æˆ–è€…å«åŠ¨æ€ç¼–è¯‘ï¼Œå…³äºç±»ä¸ç»§æ‰¿æŠ½è±¡ç±»çš„é¢å‘å¯¹è±¡æ€æƒ³ä»¥åŠ this æŒ‡å‘çš„å‡åç­‰ç­‰...

å¯¹åŒæ­¥é’©å­æ¥è¯´ï¼Œ tap æ–¹æ³•æ˜¯å”¯ä¸€æ³¨å†Œäº‹ä»¶çš„æ–¹æ³•ï¼Œé€šè¿‡ call æ–¹æ³•è§¦å‘åŒæ­¥é’©å­çš„æ‰§è¡Œã€‚
å¯¹å¼‚æ­¥é’©å­æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ tapã€tapAsyncã€tapPromise ä¸‰ç§æ–¹å¼æ¥æ³¨å†Œï¼Œé€šè¿‡å¯¹åº”çš„ callAsyncã€promise è¿™ä¸¤ç§æ–¹å¼æ¥è§¦å‘æ³¨å†Œçš„å‡½æ•°ã€‚

å››ç§é’©å­ç±»å‹ï¼šç•¥ã€‚

AsyncParallelBailHook æ˜¯ä¸€ä¸ªå¼‚æ­¥å¹¶è¡Œã€ä¿é™©ç±»å‹çš„ Hookï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæœ‰è¿”å›å€¼ï¼Œå°±ä¼šæ‰§è¡Œ callAsync ä¸­çš„å›è°ƒå‡½æ•°ã€‚AsyncParallelBailHook æ˜¯ä¸€ä¸ªå¼‚æ­¥å¹¶è¡Œã€ä¿é™©ç±»å‹çš„ Hookï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæœ‰è¿”å›å€¼ï¼Œå°±ä¼šæ‰§è¡Œ callAsync ä¸­çš„å›è°ƒå‡½æ•°ã€‚

### è°ƒè¯•ä»£ç 
ä¿®æ”¹è·¯å¾„
```
//ä¹‹å‰
const { SyncHook } = require("tapable");

//ä¿®æ”¹åï¼Œå¹¶åœ¨è¯¥è¡Œæ‰“æ–­ç‚¹
const SyncHook = require("../node_modules/tapable/lib/SyncHook");
```

### åŸç†
ä½¿ç”¨ [[Function]] ç”Ÿæˆå‡½æ•°ï¼šå½“è°ƒç”¨ call æ–¹æ³•æ—¶ï¼Œä¼šèµ°ä¸¤ä¸ªå…³é”®çš„æ­¥éª¤ï¼šå…ˆåŠ¨æ€ç”Ÿæˆæ‰§è¡Œä»£ç ï¼Œå†æ‰§è¡Œç”Ÿæˆçš„ä»£ç ã€‚
```
this.args ç”¨æ¥å­˜æ”¾å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ä¼ å…¥çš„å½¢å‚æ•°ç»„
new Function(this.args().join(","), this.header() + this.content());
```

è¿™ä¹ˆåšä¸€éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†æä½³çš„æ€§èƒ½è€ƒè™‘ï¼Œæ¯”å¦‚åªæœ‰åœ¨æ‰§è¡Œ call æ–¹æ³•æ—¶æ‰ä¼šå»åŠ¨æ€ç”Ÿæˆæ‰§è¡Œå‡½æ•°ï¼Œå¦‚æœä¸æ‰§è¡Œåˆ™ä¸å¤„ç†ï¼ˆæ‡’ç¼–è¯‘æˆ–è€…å«åŠ¨æ€ç¼–è¯‘ï¼‰ã€‚
è¿˜æœ‰ä¸€éƒ¨åˆ†åŸå› åˆ™æ˜¯ä¸ºäº†æ›´åŠ çµæ´»ã€‚åˆ«å¿˜äº†ï¼Œè¯¥åº“é‡Œé¢è¿˜æœ‰å…¶ä»–ç±»å‹çš„ Hookï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°å…¶ä»– Hookï¼Œåªéœ€è¦å®šä¹‰å¥½å„è‡ªçš„ compiler å‡½æ•°å°±å¯ä»¥äº†ã€‚
å¦å¤–ï¼ŒWebpack ä½œè€…ä¹Ÿæåˆ°è¿‡ä¸ºä»€ä¹ˆé‡‡ç”¨ new Function çš„æ–¹æ¡ˆï¼Œä¸€åˆ‡éƒ½æ˜¯ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œé“¾æ¥åœ¨è¿™é‡Œï¼šgithub. com/webpack/tapâ€¦ ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹çœ‹ã€‚

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼š https://juejin.cn/post/7164175171358556173
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

## webpack åŸç†
[[webpacké…ç½®]]

Webpack æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªé…ç½®ä¿¡æ¯ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œåè¿”å›ä¸€ä¸ª compiler å¯¹è±¡ã€‚ï¼ˆå·¥å‚æ¨¡å¼ï¼‰
è°ƒç”¨ compiler å¯¹è±¡ä¸­çš„ run æ–¹æ³•å°±ä¼šå¯åŠ¨ç¼–è¯‘ã€‚
run æ–¹æ³•æ¥å—ä¸€ä¸ªå›è°ƒï¼Œå¯ä»¥ç”¨æ¥æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯æˆ–ç¼–è¯‘ä¿¡æ¯ã€‚

```
const Webpack=(config):{run:(cb)=>void}=>{return compiler}
```

```
// debugger.js
// const { webpack } = require("./webpack.js"); //åé¢è‡ªå·±æ‰‹å†™
const { webpack } = require("webpack");
const webpackOptions = require("./webpack.config.js");
const compiler = webpack(webpackOptions);

//å¼€å§‹ç¼–è¯‘
compiler.run((err, stats) => {
  console.log(err);
  console.log(
    stats.toJson({
      assets: true, //æ‰“å°æœ¬æ¬¡ç¼–è¯‘äº§å‡ºçš„èµ„æº
      chunks: true, //æ‰“å°æœ¬æ¬¡ç¼–è¯‘äº§å‡ºçš„ä»£ç å—
      modules: true, //æ‰“å°æœ¬æ¬¡ç¼–è¯‘äº§å‡ºçš„æ¨¡å—
    })
  );
});

```
è¿è¡Œ debbuger. js ç±»ä¼¼è¿è¡Œ webpack ï¼Œå¾—åˆ°ç¼–è¯‘ç»“æœã€‚

compiler æ„é€ å‡½æ•°ï¼š
1. å­˜å‚¨é…ç½®
2. å­˜å‚¨é’©å­ï¼ˆrunã€doneï¼‰

æ’ä»¶ï¼šconfig. plugins æ’ä»¶å¯¹è±¡æ•°ç»„
```
//è‡ªå®šä¹‰æ’ä»¶WebpackDonePlugin
class WebpackDonePlugin {
  apply(compiler) {
    compiler.hooks.done.tap("WebpackDonePlugin", () => {
      console.log("ç»“æŸç¼–è¯‘");
    });
  }
}

ä½œè€…ï¼šä¸è¦ç§ƒå¤´å•Š
é“¾æ¥ï¼šhttps://juejin.cn/post/7170852747749621791
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
```

run
1. è§¦å‘å„ç§é’©å­
2. ç¼–è¯‘ï¼ˆåˆ©ç”¨ Compilation å¯¹è±¡çš„ build æ–¹æ³•ï¼‰

Compilation:
1. optionsï¼šwebpackOptions
2. modulesï¼šæ¨¡å—ã€‚
3. chunksï¼šä»£ç å—
4. assetsï¼šèµ„æºæ–‡ä»¶
5. fileDependenciesï¼šæ¶‰åŠæ–‡ä»¶ï¼ˆå…¥å£æ–‡ä»¶ï¼‰

Compilation æµç¨‹:
1. æ‰¾åˆ°å…¥å£æ–‡ä»¶
2. æ·»åŠ åˆ° fileDependencies
3. åˆ›å»º moduleï¼Œéå† test å¾—åˆ° loaderï¼Œloader å¤„ç†ã€‚
4. è¯»å–ä»£ç ä¸­çš„ä¾èµ–ï¼Œå°†å…¶åœ°å€æ·»åŠ åˆ° fileDependencies ä¸­ï¼Œå°† id å’Œè·¯å¾„æ·»åŠ åˆ° module çš„ denpendencies ä¸Šã€‚
5. è½¬æ¢å¯¼å…¥è¯­å¥æœ€ç»ˆä»£ç å¹¶ä½œä¸º module çš„_source å€¼ã€‚
6. åŠ è½½loader
```
const loader1 = (source) => {
  return source + "//ç»™ä½ çš„ä»£ç åŠ ç‚¹æ³¨é‡Šï¼šloader1";
};
```