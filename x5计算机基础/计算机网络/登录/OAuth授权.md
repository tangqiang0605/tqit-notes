[OAuth2.0授权的工作原理和OpenID Connect的作用\_哔哩哔哩\_bilibili](https://www.bilibili.com/video/BV1kk4y1n7Ks/?spm_id_from=333.999.0.0&vd_source=a192bbc2c82b7725cd9d5149075acda1)

OAuth：可以用第三方账户登录。减少向普通小网站暴露密码。

OAuth 在登录认证的验证步骤，通过用户从授权服务器得到的授权码，后台进行验证。而第二步的授权则可用使用 session 或 token。

## 概念

三个角色：用户，授权服务器，资源服务器（小网站）。

四种模式。其中客户端模式就是消耗 api 的场景比如地图 api。

认证的本质是为了保护资源服务器的资源，对用户进行身份认证，而不是随便什么人都可以访问网站。

用户要向资源服务器请求资源，需要有能够验证用户身份的 token。用户给服务器来自授权服务器的授权码，服务器拿授权码+secret 和授权服务器认证，认证成功生成 token 给用户。

资源服务器信任第三方授权服务器，也就信任持有第三方授权服务器授予的授权码的用户，进而访问资源。而用户要获得授权服务器的信任，一般是通过登录其网站进行身份验证。

另一方面，用户对资源服务器不信任，但有授权服务器做保证，用户可以信任服务器。从这一角度，资源服务器需要向授权服务器注册授权功能。

可靠的认证原理：
1. 用户要访问资源服务器，需要认证。
2. 用户可以使用授权服务器的认证。
3. 用户要获得授权服务器的认证，也需要得到授权服务器的认证。
4. 用户可能需要登录授权服务器。

## 实现的过程
1. 向授权服务器提供授权的必要信息（比如授权的网站，返回的url）
2. 授权服务器验证成功，返回授权码给前端（通过 url 的 query 的方式），对外是暴露的，前端把授权码交给后台，后台去向授权服务器验证，然后换取或生成 token，并返回 token 给前端（隐藏的）。
3. 资源服务器通过授权码向授权服务器验证，并获取或生成 token，资源服务器就可以使用 token 向授权服务器要账号信息
