## 渲染机制
笔记
nextjsv13 新特性，对渲染机制的优化。
1. 推出 app router 模式
2. 支持 use client 指令

混合渲染：
1. 早期，服务端渲染。
2. v13，服务端渲染+客户端渲染（混合渲染）

网络边界
1. 网络请求的生命周期（过程）：交互、请求，服务器处理、返回、渲染、下一轮交互。
2. 两种渲染的优势和场景
3. 使用 use client 划分网络边界（渲染环境）。

NextJS 的页面和组件默认是服务端渲染，只有使用了 use client 指令的页面或组件，它和它的子组件都将是客户端渲染。

那么 NextJS 推荐开发者划分网络边界的原因是什么呢？总结下来有这几点：
分离关注点：网络边界的不同侧关注不同的功能，客户端关注用户界面，服务器端关注数据获取和处理。明确分离有利于模块化开发。
利用不同环境的优势：客户端和服务器端有各自的优势，例如客户端可以快速交互，服务器端可以访问数据库。划分边界可以发挥两者优势。
优化性能：适当地划分边界可以优化应用加载速度、响应速度等性能。比如服务器渲染可以加快首屏加载。
调整部署位置：边界可以让部分代码运行在客户机，部分在服务器。这为代码部署提供灵活性。
安全：对边界两侧的代码施加不同限制，可以提高应用安全性。
离线使用：客户端代码可以在断网时继续工作，提高应用可靠性。


## 服务端组件和客户端组件
本文将展开介绍 NextJS v13 服务端渲染和客户端渲染的工作原理、使用时机，以及官方推荐的最佳实践。

服务端组件就是在服务端渲染的组件，使用 NextJS v13 的项目，只要是在 app 目录内的页面，全部默认为服务端组件。
优势：数据库、安全、缓存、包大小、fcp（首帧）、流式传输

混合渲染原理：通过 suspense 实现流式渲染，把页面返回给客户端，和客户端组件混合。

静态渲染（默认）：


客户端组件优势：交互性、浏览器 api。

在 NextJS，客户端组件会根据请求是完整页面加载（首次访问应用程序或浏览器刷新触发的页面重载）的一部分还是后续导航而以不同方式呈现。
1. 完整页面加载：渲染客户端组件和服务端组件。
2. 后续导航：客户端组件不再需要客户端的渲染。只传输客户端组件的数据或服务端组件的页面。
![[Pasted image 20240113213924.png]]
[NextJS v13服务端组件和客户端组件及最佳实践 | J 实验室](https://weijunext.com/article/9e02de2e-c76c-4b82-998a-9e7066450c42#0ee1311f63f745dfa9ebaa6d0ef5fd58)